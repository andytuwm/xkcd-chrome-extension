function reqListener(){displayedComic=this.response.num,comicTitle=this.response.title,currentUrl="http://xkcd.com/"+displayedComic,document.getElementById("comicTitle").innerHTML=this.response.title,document.getElementById("comicNumber").innerHTML="#"+displayedComic,document.getElementById("comic").src=this.response.img,document.getElementById("comic").alt=comicTitle,document.getElementById("comic").title=this.response.alt,update(hist)}function setup(){latestComic=this.response.num;var a=reqListener.bind(this);a(),document.getElementById("end").dismiss}function setComic(a){var b=new XMLHttpRequest;b.responseType="json",b.onload=reqListener,b.open("GET",a,!0),b.send()}function getFirst(){1!=displayedComic?setComic("http://xkcd.com/1/info.0.json"):document.getElementById("end").show()}function getPrevious(){displayedComic-1>=1?setComic("http://xkcd.com/"+(displayedComic-1)+"/info.0.json"):document.getElementById("end").show()}function getRandom(){var a=Math.floor(Math.random()*latestComic+1);setComic("http://xkcd.com/"+a+"/info.0.json")}function getNext(){latestComic>=displayedComic+1?setComic("http://xkcd.com/"+(displayedComic+1)+"/info.0.json"):document.getElementById("end").show()}function getLast(){displayedComic!=latestComic?setComic("http://xkcd.com/info.0.json"):document.getElementById("end").show()}function openComic(){chrome.tabs.create({url:currentUrl,active:!1})}function searchComic(){13===window.event.keyCode&&(comicSearch=document.getElementById("input").committedValue,comicSearch.match(/[a-z]/i)||!comicSearch.match(/[0-9]+/)?document.getElementById("badinput").show():comicSearch==displayedComic?document.getElementById("already").show():comicSearch>0&&latestComic>=comicSearch?setComic("http://xkcd.com/"+comicSearch+"/info.0.json"):document.getElementById("badnum").show(),document.getElementById("input").value="")}function openHelp(){chrome.tabs.create({url:"http://www.explainxkcd.com/wiki/index.php/"+displayedComic,active:!1})}function update(a){var b=displayedComic+": "+comicTitle,c={com:displayedComic,disp:b};if(historyContains(a,displayedComic)){var d=findIndex(a,displayedComic);if(d>-1){var e=a.splice(d,1);a.push(e[0])}else console.error("Error: Index should always be found if comic was found in history.")}else a.length<10?a.push(c):(a.shift(),a.push(c)),arraybind.historyList=a;chrome.storage.sync.set({browsed:a},function(){})}function restoreComic(){comicIndex=menuItemGetter.selectedIndex;var a=hist[comicIndex].com;setComic("http://xkcd.com/"+a+"/info.0.json"),menuItemGetter.selected=null}function historyContains(a,b){for(var c=0;c<a.length;c++)if(a[c].com==b)return!0;return!1}function findIndex(a,b){for(var c=0;c<a.length;c++)if(a[c].com==b)return c;return-1}function imgError(){document.getElementById("404").show()}var oReq=new XMLHttpRequest,displayedComic=null,latestComic=null,comicSearch=null,comicTitle=null,currentUrl="http://xkcd.com/",arraybind=document.querySelector("#array"),hist=[];chrome.storage.sync.get("browsed",function(a){hist=a.browsed,arraybind.historyList=hist}),oReq.responseType="json",oReq.onload=setup,oReq.open("GET","http://xkcd.com/info.0.json",!0),oReq.send();var first=document.getElementById("first"),prev=document.getElementById("prev"),rand=document.getElementById("random"),next=document.getElementById("next"),last=document.getElementById("last"),image=document.getElementById("comic"),search=document.getElementById("search"),help=document.getElementById("explain"),menuItemGetter=document.querySelector("#historyMenu"),img=document.querySelector("#comic");first.onload=first.addEventListener("click",getFirst,!1),prev.onload=prev.addEventListener("click",getPrevious,!1),rand.onload=rand.addEventListener("click",getRandom,!1),next.onload=next.addEventListener("click",getNext,!1),last.onload=last.addEventListener("click",getLast,!1),image.onload=image.addEventListener("click",openComic,!1),search.onload=search.addEventListener("keyup",searchComic,!1),explain.onload=explain.addEventListener("click",openHelp,!1),menuItemGetter.onload=menuItemGetter.addEventListener("core-activate",restoreComic,!1),img.onerror=imgError;